<html>
 <head></head> 
 <body> 
  <p><strong>问题描述</strong></p> 
  <p>客户制作了一个带有参数模板的报表组，客户希望在点击查询报表组之后，页面不跳转回报表组的第一个tab页，而是停留在客户点击查询按钮时的tab页面。而目前润乾报表默认的方式是跳转回到第一个tab页，不会停留在当前tab页上，所以要实现客户的需求采用js的方式给报表传参数，控制报表显示的tab页。</p> 
  <p><strong>实现思路</strong></p> 
  <p>给报表组的页面传一个参数showFlag，通过这个参数控制报表显示或者隐藏哪个tab页，再点击tab页标签的时候就给页面传对应的showFlag参数，然后调用润乾的点击tab页的函数，这样如果把参数顺利传递过去就可以控制报表显示或隐藏哪个tab页了。</p> 
  <p><strong>实现步骤</strong></p> 
  <p><strong>1，以三个tab页的报表组为例，通过showFlag参数控制报表组显示或隐藏tab页的java代码和js函数如下：</strong></p> 
  <p>&lt;%<br /> out.println(”showFlag:”+showFlag);<br /> if(”2″.equals(showFlag)){%&gt;<br /> 标志为2的时候就显示第二张报表，就是div名字为div_item2的层<br /> &lt;script language=”javascript”&gt;<br /> document.getElementById( “div_item1″ ).style.display = “none”;<br /> document.getElementById( “div_item2″ ).style.display = “”;<br /> document.getElementById( “div_item3″ ).style.display = “none”;<br /> //更改tab页字体的颜色<br /> document.getElementById(”tab_item1″).className=””;<br /> document.getElementById(”tab_item2″).className=”rq_curr”;<br /> document.getElementById(”tab_item3″).className=””;<br /> &lt;/script&gt;<br /> &lt;%}else if(”3″.equals(showFlag)){%&gt;<br /> 显示第三个报表的div，隐藏第一、二个报表的div<br /> &lt;script language=”javascript”&gt;<br /> document.getElementById( “div_item3″ ).style.display = “”;<br /> document.getElementById( “div_item2″ ).style.display = “none”;<br /> document.getElementById( “div_item1″ ).style.display = “none”;<br /> document.getElementById(”tab_item3″).className=”rq_curr”;<br /> document.getElementById(”tab_item2″).className=””;<br /> document.getElementById(”tab_item1″).className=””;<br /> &lt;/script&gt;<br /> &lt;%}<br /> else{%&gt;<br /> 显示第一个报表的div，隐藏第二、三个报表的div<br /> &lt;script language=”javascript”&gt;<br /> document.getElementById( “div_item1″ ).style.display = “”;<br /> document.getElementById( “div_item2″ ).style.display = “none”;<br /> document.getElementById( “div_item3″ ).style.display = “none”;<br /> document.getElementById(”tab_item1″).className=”rq_curr”;<br /> document.getElementById(”tab_item2″).className=””;<br /> document.getElementById(”tab_item3″).className=””;<br /> &lt;/script&gt;<br /> &lt;%}%&gt;</p> 
  <p>这样就可以实现通过showFlag参数值不同设置隐藏或显示相应的tab页。</p> 
  <p><strong>2，制作报表组的参数模板：</strong></p> 
  <p>参数模板的样式如下图所示，需要注意的是第二行B2单元格的变量名设置为showFlag，也就是上面提到的参数。<br /> <img src="http://www.runqian.com.cn/know-how/wp-content/uploads/2010/08/zrclip-001p6a3fb7e7.png" alt="" width="553" height="251" /></p> 
  <p><strong>3，通过点击tab页给报表组传参数，设置tab页的隐藏属性。代码如下：</strong></p> 
  <p>&lt;script language=”javascript”&gt;<br /> //重新定义第二个报表tab页的点击事件<br /> document.getElementById(’tab_item2′).onclick=function()<br /> { //显示第二个报表的div，隐藏第一、三个报表的div<br /> document.getElementById( “div_item1″ ).style.display = “none”;<br /> document.getElementById( “div_item2″ ).style.display = “”;<br /> document.getElementById( “div_item3″ ).style.display = “none”;<br /> //更改tag标签字体的颜色<br /> document.getElementById(”tab_item1″).className=””;<br /> document.getElementById(”tab_item2″).className=”rq_curr”;<br /> document.getElementById(”tab_item3″).className=””;<br /> //调用快逸自定义的tab页自定义函数<br /> _groupClicked(document.getElementById(’tab_item2′));<br /> document.getElementById(”showFlag”).value=2;<br /> }<br /> //重新定义第一个报表tab页的点击事件<br /> document.getElementById(’tab_item1′).onclick=function(){<br /> document.getElementById( “div_item1″ ).style.display = “”;<br /> document.getElementById( “div_item2″ ).style.display = “none”;<br /> document.getElementById( “div_item3″ ).style.display = “none”;<br /> document.getElementById(”tab_item1″).className=”rq_curr”;<br /> document.getElementById(”tab_item2″).className=””;<br /> document.getElementById(”tab_item3″).className=””;<br /> _groupClicked(document.getElementById(’tab_item1′));<br /> document.getElementById(”showFlag”).value=1;<br /> }<br /> //重新定义第三个报表tab页的点击事件<br /> document.getElementById(’tab_item3′).onclick=function(){<br /> document.getElementById( “div_item3″ ).style.display = “”;<br /> document.getElementById( “div_item2″ ).style.display = “none”;<br /> document.getElementById( “div_item1″ ).style.display = “none”;<br /> document.getElementById(”tab_item3″).className=”rq_curr”;<br /> document.getElementById(”tab_item2″).className=””;<br /> document.getElementById(”tab_item1″).className=””;<br /> _groupClicked(document.getElementById(’tab_item3′));<br /> document.getElementById(”showFlag”).value=3;<br /> }<br /> <strong>&lt;/script&gt;</strong></p> 
  <p><strong>4，编写完整的jsp代码：</strong></p> 
  <p>有了以上的js函数和报表组参数模板的设置，就可以编写完整的jsp代码来发布报表组了，jsp的全部代码如下：</p> 
  <p>&lt;%@ page contentType=”text/html;charset=GBK” %&gt;<br /> &lt;%@ taglib uri=”/WEB-INF/runqianReport4.tld” prefix=”report” %&gt;<br /> &lt;%@ page import=”java.io.*”%&gt;<br /> &lt;%@ page import=”java.util.*”%&gt;<br /> &lt;%@ page import=”com.runqian.report4.view.*”%&gt;<br /> &lt;html&gt;<br /> &lt;body topmargin=0 leftmargin=0 rightmargin=0 bottomMargin=0&gt;<br /> &lt;%<br /> String showFlag1 = request.getParameter(”showFlag”);<br /> //接收参数，把参数拼成name=value;name2=value2;…..的形式<br /> StringBuffer param=new StringBuffer();<br /> Enumeration paramNames = request.getParameterNames();<br /> if(paramNames!=null){<br /> while(paramNames.hasMoreElements()){<br /> String paramName = (String) paramNames.nextElement();<br /> String paramValue=request.getParameter(paramName);<br /> if(paramValue!=null){<br /> //把参数拼成name=value;name2=value2;…..的形式<br /> param.append(paramName).append(”=”).append(paramValue).append(”;”);<br /> }<br /> }<br /> }<br /> String reportParamsId=request.getParameter(”reportParamsId”);<br /> Hashtable params = null;<br /> String showFlag=null;<br /> if(!””.equals(reportParamsId) &amp;&amp; reportParamsId != null){<br /> params = com.runqian.report4.view.ParamsPool.get( reportParamsId );<br /> showFlag=(String) params.get(”showFlag”);<br /> } else{<br /> showFlag=request.getParameter(”showFlag”);<br /> //out.print(”showFlag=============”+showFlag);<br /> if(showFlag==null || showFlag.equals(””)){<br /> showFlag=”1″;<br /> }<br /> %&gt;<br /> &lt;table id=”rpt” align=”center”&gt;&lt;tr&gt;&lt;td&gt;<br /> &lt;table id=”param_tbl” width=”100%” height=”100%” align=”top”&gt;&lt;tr&gt;&lt;td&gt;<br /> &lt;report:param name=”form1″ paramFileName=”group_arg.raq”<br /> needSubmit=”no”<br /> params=”&lt;%=param.toString()%&gt;”<br /> /&gt;<br /> &lt;/td&gt;<br /> &lt;td&gt;&lt;a href=”javascript:_submit( form1 )”&gt;&lt;img src=”../images/query.jpg” border=no style=”vertical-align:middle”&gt;&lt;/a&gt;&lt;/td&gt;<br /> &lt;/tr&gt;&lt;/table&gt;<br /> &lt;!–导入存有工具栏的jsp–&gt;<br /> &lt;jsp:include page=”toolbar.jsp” flush=”false” /&gt;<br /> &lt;table align=center&gt;<br /> &lt;tr&gt;&lt;td&gt;<br /> &lt;report:group groupFileName=”group.rpg”<br /> funcBarLocation=””<br /> exceptionPage=”/reportJsp/myError2.jsp”<br /> params=”&lt;%=param.toString()%&gt;”<br /> /&gt;<br /> &lt;/td&gt;&lt;/tr&gt;<br /> &lt;/table&gt;<br /> &lt;%<br /> if(”2″.equals(showFlag)){%&gt;<br /> 标志为2的时候就显示第二张报表，就是div名字为div_item2的层<br /> &lt;script language=”javascript”&gt;<br /> document.getElementById( “div_item1″ ).style.display = “none”;<br /> document.getElementById( “div_item2″ ).style.display = “”;<br /> document.getElementById( “div_item3″ ).style.display = “none”;<br /> //更改tab页字体的颜色<br /> document.getElementById(”tab_item1″).className=””;<br /> document.getElementById(”tab_item2″).className=”rq_curr”;<br /> document.getElementById(”tab_item3″).className=””;<br /> &lt;/script&gt;<br /> &lt;%}else if(”3″.equals(showFlag)){%&gt;<br /> 显示第三个报表的div，隐藏第一、二个报表的div<br /> &lt;script language=”javascript”&gt;<br /> document.getElementById( “div_item3″ ).style.display = “”;<br /> document.getElementById( “div_item2″ ).style.display = “none”;<br /> document.getElementById( “div_item1″ ).style.display = “none”;<br /> document.getElementById(”tab_item3″).className=”rq_curr”;<br /> document.getElementById(”tab_item2″).className=””;<br /> document.getElementById(”tab_item1″).className=””;<br /> &lt;/script&gt;<br /> &lt;%}<br /> else{%&gt;<br /> 显示第一个报表的div，隐藏第二、三个报表的div<br /> &lt;script language=”javascript”&gt;<br /> document.getElementById( “div_item1″ ).style.display = “”;<br /> document.getElementById( “div_item2″ ).style.display = “none”;<br /> document.getElementById( “div_item3″ ).style.display = “none”;<br /> document.getElementById(”tab_item1″).className=”rq_curr”;<br /> document.getElementById(”tab_item2″).className=””;<br /> document.getElementById(”tab_item3″).className=””;<br /> &lt;/script&gt;<br /> &lt;%}%&gt;<br /> &lt;script language=”javascript”&gt;<br /> //重新定义第二个报表tab页的点击事件<br /> document.getElementById(’tab_item2′).onclick=function()<br /> { //显示第二个报表的div，隐藏第一、三个报表的div<br /> document.getElementById( “div_item1″ ).style.display = “none”;<br /> document.getElementById( “div_item2″ ).style.display = “”;<br /> document.getElementById( “div_item3″ ).style.display = “none”;<br /> //更改tag标签字体的颜色</p> 
  <p>document.getElementById(”tab_item1″).className=””;<br /> document.getElementById(”tab_item2″).className=”rq_curr”;<br /> document.getElementById(”tab_item3″).className=””;<br /> //调用快逸自定义的tab页自定义函数<br /> _groupClicked(document.getElementById(’tab_item2′));<br /> document.getElementById(”showFlag”).value=2;<br /> }<br /> //重新定义第一个报表tab页的点击事件<br /> document.getElementById(’tab_item1′).onclick=function(){<br /> document.getElementById( “div_item1″ ).style.display = “”;<br /> document.getElementById( “div_item2″ ).style.display = “none”;<br /> document.getElementById( “div_item3″ ).style.display = “none”;<br /> document.getElementById(”tab_item1″).className=”rq_curr”;<br /> document.getElementById(”tab_item2″).className=””;<br /> document.getElementById(”tab_item3″).className=””;<br /> _groupClicked(document.getElementById(’tab_item1′));<br /> document.getElementById(”showFlag”).value=1;<br /> }<br /> //重新定义第三个报表tab页的点击事件<br /> document.getElementById(’tab_item3′).onclick=function(){<br /> document.getElementById( “div_item3″ ).style.display = “”;<br /> document.getElementById( “div_item2″ ).style.display = “none”;<br /> document.getElementById( “div_item1″ ).style.display = “none”;<br /> document.getElementById(”tab_item3″).className=”rq_curr”;<br /> document.getElementById(”tab_item2″).className=””;<br /> document.getElementById(”tab_item1″).className=””;<br /> _groupClicked(document.getElementById(’tab_item3′));<br /> document.getElementById(”showFlag”).value=3;<br /> }<br /> &lt;/script&gt;<br /> &lt;/body&gt;<br /> &lt;/html&gt;</p> 
  <p><strong>5，制作并发布报表组：</strong></p> 
  <p>制作一个有三个tab页的报表组，命名为group.rpg，然后命名上面制作的参数模板为group_arg.raq，最后用上面的jsp发布报表组。</p> 
  <p>点击查询按钮后报表组仍然停留在当前的tab页，而没有跳转的第一个tab页。</p> 
  <p>具体如下：</p> 
  <p><img src="http://www.runqian.com.cn/know-how/wp-content/uploads/2010/08/zrclip-002n308253b6.png" alt="" width="553" height="243" /></p> 
  <p>在报表中点击查询按钮后，页面停留在客户点击查询按钮时的tab页面的功能就实现了。</p>  
 </body>
</html>