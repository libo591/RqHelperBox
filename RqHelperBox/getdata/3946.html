<html>
 <head></head> 
 <body> 
  <p></p> 
  <p style="TEXT-ALIGN: center; LINE-HEIGHT: 27pt; MARGIN: 7.5pt 0cm" class="MsoNormal" align="center"><b><span style=" ">轻松实现大数据量下的折叠报表</span></b><b></b></p> 
  <br /> 
  <p style="TEXT-ALIGN: right; LINE-HEIGHT: 27pt; MARGIN: 7.5pt 0cm" class="MsoNormal" align="right"><b><span style="">–</span></b><b><span style="">解决方案及部署方法</span></b></p> 
  <br /> 
  <h2 style="BACKGROUND: white"><span style="">问题背景</span></h2> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">树状报表是比较常见的一类报表，不但使得终端用户查看数据更加方便，并且数据展现更具层次感，因此也就更加直观易懂。</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" "></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" "><img border="0" src="/reportmis/mis2/reportcenter/ewebeditor/imgServlet?fileID=63156a76-aed6-4d99-9ae5-81bcdd22a62d" /><br />&nbsp;&nbsp;&nbsp; </span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">如此好的报表类型，也是较多用户的需求。集智数据平台当然也会毫无吝啬的提供给客户使用。并且，重要的是平台提供的折叠报表，更好的满足了针对大数据量的性能需求。</span></p> 
  <br /> 
  <h2 style="BACKGROUND: white"><span style="">解决方案及部署过程</span></h2> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">一、实现功能：</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" "></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">折叠报表在展开下一节点的时候，实现动态从后台数据库中取数；一旦一个节点的下一级节点的数据被取到后，该节点再次展开和折叠则不会再次请求数据</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" "></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">二、程序用法</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" "></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">1</span><span style=" ">、将样式文件和</span><span style="">js</span><span style=" ">文件添加到应用中</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" "></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">将压缩包里</span><span style="">js</span><span style=" ">文件夹和</span><span style="">style</span><span style=" ">文件夹中文件放到应用中</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" "></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">2</span><span style=" ">、在展现折叠报表页面引入样式文件和</span><span style="">js</span><span style=" ">文件</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" "></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">在展现折叠报表的页面引入折叠报表相关的</span><span style="">js</span><span style=" ">（压缩包下</span><span style="">js</span><span style=" ">文件夹下的所有文件）和</span><span style="">css</span><span style=" ">样式</span><span style="">(</span><span style=" ">压缩包下</span><span style="">style</span><span style=" ">文件夹下</span><span style="">)</span><span style=" ">文件，如：</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" "></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&lt;!– </span><span style=" ">引入必要的</span><span style="">js</span><span style=" ">和</span><span style="">css –&gt;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&lt;script type=”text/javascript” src=”js/jquery.js”&gt;&lt;/script&gt;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&lt;script type=”text/javascript” src=”js/report_tree.js”&gt;&lt;/script&gt;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&lt;script type=”text/javascript” src=”js/Base64.js”&gt;&lt;/script&gt;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&lt;link rel=”stylesheet” type=”text/css” href=”style/treeReport/default.css”&gt;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&lt;!– </span><span style=" ">引入必要的</span><span style="">js</span><span style=" ">和</span><span style="">css end –&gt;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=""></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">3</span><span style=" ">、调用</span><span style="">js</span><span style=" ">方法</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" "></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">在展现折叠报表页面需要引入初始化折叠报表方法，代码如下：</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&lt;script type=”text/javascript”&gt;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //</span><span style=" ">定义等待图片路径</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var waitImagePath = “style/treeReport/images/loading.gif”;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // </span><span style=" ">初始化折叠报表</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(document).ready(function(){</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReportTreeManager.init(‘report1′,’&lt;%=request.getContextPath()%&gt;’,'&lt;%=params.toString()%&gt;’);</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&lt;/script&gt;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=""></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">4</span><span style=" ">、将折叠报表使用的</span><span style="">jar</span><span style=" ">文件</span><span style="">puckerReport.jar</span><span style=" ">、</span><span style="">json.jar</span><span style=" ">引入到项目中</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" "></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">5</span><span style=" ">、在</span><span style="">web.xml</span><span style=" ">文件中添加</span><span style="">servlet</span><span style=" ">定义，代码如下</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" "></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&nbsp; &lt;servlet&gt;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;servlet-name&gt;treeReportServlet&lt;/servlet-name&gt;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;servlet-class&gt;com.runqianapp.report.view.TreeReportServlet&lt;/servlet-class&gt;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&nbsp; &lt;/servlet&gt;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&nbsp; &lt;servlet-mapping&gt;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&nbsp;&nbsp;&nbsp; &lt;servlet-name&gt;treeReportServlet&lt;/servlet-name&gt;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&nbsp;&nbsp;&nbsp; &lt;url-pattern&gt;/treeReportServlet&lt;/url-pattern&gt;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">&nbsp; &lt;/servlet-mapping&gt;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=""></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">三、报表制作</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" "></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">该折叠报表有几级折叠，就应该做几张报表，每张报表是一个需要折叠的级</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">在需要</span><span style="">“</span><span style=" ">展开</span><span style="">/</span><span style=" ">折叠</span><span style="">“</span><span style=" ">的单元格的</span><span style="">HTML</span><span style=" ">事件中添加如下代码：</span><span style="">“iddata=’”+value()+”‘ piddata=” nextReport=’collapse_report_lv2.raq’”</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" "></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">注意：</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">1</span><span style=" ">、第一级报表是通过展现折叠报表的</span><span style="">jsp</span><span style=" ">页面的报表展现标签引入的</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">2</span><span style=" ">、除第一级报表外，其他每一级报表都有一个参数名为“</span><span style="">parent</span><span style=" ">”的参数，表示上一级</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">3</span><span style=" ">、最后一级报表没有</span><span style="">“</span><span style=" ">展开</span><span style="">/</span><span style=" ">折叠</span><span style="">“</span><span style=" ">的单元格，则在第一个显示数据的单元格的</span><span style="">HTML</span><span style=" ">事件中添加如下代码：</span><span style="">“iddata=’”+value()+”‘ piddata=” “</span><span style=" ">，因为它是最后一级，没有下一级报表</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">4</span><span style=" ">、报表所需的参数在每一级报表中都得使用</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" "></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">四、展开</span><span style="">/</span><span style=" ">折叠图片的使用</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" "></span>&nbsp;</p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">这两个图片的定义是在</span><span style="">default.css</span><span style=" ">文件中的，代码如下：</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">td.plus{background-image:url(‘images/plus.png’)}//</span><span style=" ">已折叠图片</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">td.minus{background-image:url(‘images/minus.png’)}//</span><span style=" ">已展开图片</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">若需更改此图片，在此处修改即可</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">五、等待图片的使用</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">为了方便更改等待图片，等待图片的路径定义在</span><span style="">jsp</span><span style=" ">页面上的</span><span style="">javascript</span><span style=" ">标签内，代码如下：</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style="">var waitImagePath = “style/treeReport/images/loading.gif”;</span></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">如需更改等待图片，修改此处代码即可</span></p> 
  <br /> 
  <p style="BACKGROUND: white" class="MsoNormal"><b><span style=" "></span></b>&nbsp;</p> 
  <br /> 
  <p style="BACKGROUND: white" class="MsoNormal"><b><span style=" ">总结</span></b><b></b></p> 
  <br /> 
  <p style="TEXT-INDENT: 21pt; BACKGROUND: white" class="MsoNormal"><span style=" ">通过上述操作，就可以完成折叠报表的制作，帮助用户更方便、更直观、更高效的查看大数据量的报表。</span></p> 
  <br /> 
  <p></p>  
 </body>
</html>