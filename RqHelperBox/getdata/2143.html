<html>
 <head></head> 
 <body> 
  <p>润乾报表提供了excel导入页面后入库的功能,丰富了用户导入excel的方式。对于普通填报表,润乾报表提供了直接后台入库和导入页面入库的方式,那么在行式填报表中,如何实现后台导入excel入库呢?</p> 
  <p>用润乾报表提供的API接口,就可以完成这个功能。</p> 
  <p>下面是示例代码：</p> 
  <p>&lt;%@ page contentType=”text/html;charset=GBK” %&gt;<br /> &lt;%@ page import=”com.runqian.report4.usermodel.*”%&gt;<br /> &lt;%@ page import=”com.runqian.base4.util.*”%&gt;<br /> &lt;%@ page import=”com.runqian.report4.model.*”%&gt;<br /> &lt;%@ page import=”com.runqian.report4.util.*”%&gt;<br /> &lt;%@ page import=”com.runqian.report4.cache.CacheManager”%&gt;<br /> &lt;%@ page import=”java.io.*”%&gt;</p> 
  <p>&lt;%@ page import=”com.runqian.report4.dataset.DataSet”%&gt;<br /> &lt;%@ page import=”com.runqian.report4.dataset.SQLDataSetFactory”%&gt;<br /> &lt;%@ page import=”com.runqian.report4.view.olap.OlapUtils”%&gt;<br /> &lt;%@ page import=”com.runqian.report4.view.excel.ExcelReport”%&gt;<br /> &lt;%@ page import=”java.sql.Connection”%&gt;<br /> &lt;%@ page import=”java.sql.Driver”%&gt;<br /> &lt;%@ page import=”java.sql.DriverManager”%&gt;<br /> &lt;%@page import=”com.runqian.report4.ide.ExcelImporter”%&gt;<br /> &lt;%@page import=”com.runqian.report4.usermodel.input.InputProperty”%&gt;<br /> &lt;%@page import=”com.runqian.report4.input.DataSaver”%&gt;<br /> &lt;%@page import=”com.runqian.report4.model.engine.ExtCellSet”%&gt;<br /> &lt;%@page import=”com.runqian.report4.model.engine2.RowReport”%&gt;<br /> &lt;%@page import=”com.runqian.report4.input.RowReportSaver”%&gt;<br /> &lt;%@page import=”java.text.SimpleDateFormat”%&gt;<br /> &lt;%@page import=”com.runqian.base4.resources.FormatUtils”%&gt;<br /> &lt;%@page import=”java.util.Locale”%&gt;<br /> <br /> <br /> <br /> </p> 
  <p></p> 
  <p>&lt;%<br /> //设置报表路径<br /> String reportFile = “D:\\testupdate.raq”;<br /> Context cxt = new Context();<br /> ReportDefine rd = null;<br /> try {<br /> //读取报表模版定义<br /> rd = (ReportDefine) ReportUtils.read(reportFile);<br /> } catch (Exception e) {<br /> // TODO Auto-generated catch block<br /> e.printStackTrace();<br /> }<br /> System.out.println(”报表读取完毕===================================”);<br /> //计算报表<br /> Engine engine = new Engine(rd, cxt);<br /> IReport iReport = engine.calc();<br /> //将计算完的报表转换成行式报表对象<br /> RowReport rr = (RowReport)iReport;<br /> //第几行是主扩展行<br /> String did = rr.getDetailID( 1 );<br /> //定义报表保存的参数<br /> SimpleDateFormat dateF = new SimpleDateFormat( FormatUtils.getDateFormat( Locale.getDefault() ) );<br /> SimpleDateFormat timeF = new SimpleDateFormat( FormatUtils.getTimeFormat( Locale.getDefault() ) );<br /> SimpleDateFormat datetimeF = new SimpleDateFormat( FormatUtils.getDatetimeFormat( Locale.getDefault() ) );<br /> //设置excel路径<br /> String excelFile = “D:\\test1500.xls”;<br /> //生成excel导入对象<br /> ExcelImporter ei = new ExcelImporter(excelFile);<br /> //得到excel中的第一个sheet的对象<br /> IReport excelReport = ei.getReport(0);<br /> //构造数据保存对象<br /> RowReportSaver rowSaver = new RowReportSaver(rr, null, cxt);<br /> //读入excel文件及其数据<br /> //逐行逐列把excel数据写入填报表<br /> for(int i=1;i&lt;=excelReport.getRowCount();i++){<br /> //先插入一行,这里是不定行导入excel数据<br /> Area area = rr.insertDetail( did );<br /> //循环取得excel单元格<br /> for(int j=1;j&lt;=iReport.getColCount();j++){<br /> INormalCell iExcelCell=excelReport.getCell(i, (short)j);</p> 
  <p>if( iExcelCell == null ) continue;<br /> String svalue = “”;<br /> //得到单元格的值<br /> Object value = iExcelCell.getValue();<br /> if( value != null )<br /> svalue = value.toString();<br /> //把填报值保存到数据保存对象中<br /> rowSaver.setCellInputValue( area.getBeginRow(), (short)j, svalue, dateF, timeF, datetimeF );</p> 
  <p>}</p> 
  <p>}<br /> //执行保存<br /> rowSaver.save();<br /> out.print(”数据保存成功”);</p> 
  <p>%&gt;</p> 
  <p><br /> </p> 
  <p>通过这样的方式，我们就可以利用API来对行式填报表进行后台数据直接入库的功能了。 </p>  
 </body>
</html>