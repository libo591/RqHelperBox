<html>
 <head></head> 
 <body> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (1)在hibernate框架中应用报表，可能会出现报表找不到数据源的错误。<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (2) 在Hibernate框架 sqlserver2000数据库中应用报表，在填报时可能会报错，错误提示：<br /> [Microsoft][SQLServer 2000 Driver for JDBC]Can’t start a cloned connection while in manual transaction mode.<br /> <strong>解决方案：<br /> 第一种现象解决办法：</strong><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 可以先在程序中获取hibernate的数据源，然后将数据源传递给报表标签。代码示例如下：<br />Connection conn = …..; //获得数据连接<br /> Context ctx = new Context(); //使用report4.jar中的context对象<br /> ctx.setDefDataSourceName(”mysql”); //设定数据源名<br /> DataSourceConfig dsoc = new DataSourceConfig(DBTypes.MYSQL,true,”GBK”,”GBK”,false);//配置数据源<br /> ctx.setDataSourceConfig(”mysql”,dsoc);<br /> ctx.setConnection(”mysql”,conn); //连接给context对象<br /> request.setAttribute(”report_context”,ctx); //report_context通过如下report:html中的contextname获得<br /> –&gt;<span style="AR-SA;" lang="EN-US">&lt;%<br /> &nbsp;&nbsp; Connection conn = …..;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //</span><span style="Tahoma;">获得数据连接</span><span style="AR-SA;" lang="EN-US"><br /> &nbsp;&nbsp; Context ctx = new Context();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //</span><span style="Tahoma;">使用</span><span style="AR-SA;" lang="EN-US">report4.jar</span><span style="Tahoma;">中的</span><span style="AR-SA;" lang="EN-US">context</span><span style="Tahoma;">对象</span><span style="AR-SA;" lang="EN-US"><br /> &nbsp;&nbsp; ctx.setDefDataSourceName(”mysql”);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //</span><span style="Tahoma;">设定数据源名</span><span style="AR-SA;" lang="EN-US"><br /> &nbsp;&nbsp; DataSourceConfig dsoc = new DataSourceConfig(DBTypes.MYSQL,true,”GBK”,”GBK”,false);//</span><span style="Tahoma;">配置数据源</span><span style="AR-SA;" lang="EN-US"><br /> &nbsp;&nbsp; ctx.setDataSourceConfig(”mysql”,dsoc);<br /> &nbsp;&nbsp; ctx.setConnection(”mysql”,conn);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //</span><span style="Tahoma;">连接给</span><span style="AR-SA;" lang="EN-US">context</span><span style="Tahoma;">对象</span><span style="AR-SA;" lang="EN-US"><br /> &nbsp;&nbsp; request.setAttribute(”report_context”,ctx);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //report_context</span><span style="Tahoma;">通过如下</span><span style="AR-SA;" lang="EN-US">report:html</span><span style="Tahoma;">中的</span><span style="AR-SA;" lang="EN-US">contextname</span><span style="Tahoma;">获得</span><span style="AR-SA;" lang="EN-US"><br /> %&gt;&nbsp;&nbsp;<br /> &lt;report:html name=”report1″ contextName=”report_context”/&gt;&nbsp;</span></p> 
  <div> 
   <strong>第二种现象解决办法：<br /> </strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 设置为SelectMethod=Cursor 
   <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在tomcat中为报表配置一个数据源，并在url中加入 ;SelectMethod=Cursor 
   <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在hibernate配置文件中的数据库的url中也加入;SelectMethod=Cursor 
   <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 以下是两个配置文件 
   <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hibernate.cfg.xml中的配置如下： 
  </div> 
  <p class="MsoNormal" style="0pt;" align="left"><span style="0pt;" lang="EN-US">&nbsp;&lt;session-factory&gt;<br /> &nbsp;&nbsp;&lt;property name=”connection.username”&gt;sa&lt;/property&gt;<br /> &nbsp;&nbsp;&lt;property name=”connection.url”&gt;<br /> &nbsp;&nbsp;&nbsp;jdbc:microsoft:sqlserver://localhost:1433;DatabaseName=tylstj;SelectMethod=Cursor<br /> &nbsp;&nbsp;&lt;/property&gt;<br /> &nbsp;&nbsp;&lt;property name=”dialect”&gt;<br /> &nbsp;&nbsp;&nbsp;org.hibernate.dialect.SQLServerDialect<br /> &nbsp;&nbsp;&lt;/property&gt;<br /> &nbsp;&nbsp;&lt;property name=”myeclipse.connection.profile”&gt;sql2k&lt;/property&gt;<br /> &nbsp;&nbsp;&lt;property name=”connection.password”&gt;sa&lt;/property&gt;<br /> &nbsp;&nbsp;&lt;property name=”connection.driver_class”&gt;<br /> &nbsp;&nbsp;&nbsp;com.microsoft.jdbc.sqlserver.SQLServerDriver<br /> &nbsp;&nbsp;&lt;/property&gt;</span></p> 
  <p class="MsoNormal" style="0pt;" align="left"><span style="0pt;" lang="EN-US">&lt;mapping resource=”com/tylstj/pojo/Jl01.hbm.xml” /&gt;<br /> &nbsp;&nbsp;&lt;!–</span><span style="Tahoma;">其他</span><span style="0pt;" lang="EN-US">pojo</span><span style="Tahoma;">的映射文件略</span><span style="0pt;" lang="EN-US">–&gt;</span></p> 
  <p>&nbsp;</p> 
  <p class="MsoNormal" style="0pt;" align="left"> 在tomcat5.5.20中数据源配置如下：</p> 
  <p class="MsoNormal" style="0pt;" align="left"><span style="0pt;" lang="EN-US">&lt;Context path=”/WebTylsj” docBase=”WebTylsj”<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; privileged=”true” antiResourceLocking=”false” antiJARLocking=”false”&gt;<br /> &nbsp;&nbsp; &lt;Resource name = “sql2k” auth=”Container” type = “javax.sql.DataSource”<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxActive=”5″ maxIdle=”2″ maxWait=”10000″ username=”sa” password=”sa”<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; driverClassName=”com.microsoft.jdbc.sqlserver.SQLServerDriver”&nbsp;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; url=”jdbc:microsoft:sqlserver://localhost:1433;DatabaseName=tylstj;SelectMethod=Cursor”/&gt;<br /> &lt;/Context&gt;</span></p> 
  <p class="MsoNormal" style="0pt;" align="left">&nbsp;</p>  
 </body>
</html>