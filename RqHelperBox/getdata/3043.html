<html>
 <head></head> 
 <body> 
  <h2><span style="font-family: 宋体;">需求背景</span></h2> 
  <p class="MsoNormal"><span><span>&nbsp;</span></span><span style="font-family: 宋体;">这段时间常常有客户会有这样的问题：在我们的应用中已经有现成的数据库</span><span>Connection</span><span style="font-family: 宋体;">了，如何使用这个</span><span>connection</span><span style="font-family: 宋体;">通过</span><span>bean</span><span style="font-family: 宋体;">方式发布报表组呢？</span></p> 
  <h2><span style="font-family: 宋体;">问题分析</span></h2> 
  <p class="MsoNormal"><span><span>&nbsp;</span></span><span style="font-family: 宋体;">针对这个需求，客户在实际操作的时候无一例外的遇到了数据源连接不上的问题，所以这个问题就是我们今天解决的重点，首先我们要看一下客户的实现源码：</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">&lt;%@ </span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">page </span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">contentType</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“text/html;charset=GBK” </span><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">%&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">&lt;%@ </span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">taglib </span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">uri</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“/WEB-INF/runqianReport4.tld” </span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">prefix</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“report” </span><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">%&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">&lt;%@ </span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">page </span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">import</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“com.runqian.report4.usermodel.*”</span><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">%&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">&lt;%@ </span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">page </span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">import</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“com.runqian.report4.util.ReportUtils2″ </span><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">%&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">&lt;%@ </span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">page </span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">import</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“com.runqian.base4.util.DBTypes” </span><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">%&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">&lt;%@ </span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">page </span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">import</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“java.sql.*”</span><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">%&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">&lt;%@ </span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">page </span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">import</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“java.util.*”</span><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">%&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">&lt;%@ </span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">page </span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">import</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“runqian.ConnectDemo”</span><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">%&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"> </p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&lt;</span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">html</span><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&lt;</span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">body </span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">topmargin</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;"></span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">leftmargin</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;"></span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">rightmargin</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;"></span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">bottomMargin</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">0</span><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">&lt;%</span></p> 
  <p class="MsoNormal" style="text-align: left;"> </p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;"><span>&nbsp;</span>Connection con = </span><strong><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">null</span></strong><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">;</span></p> 
  <p class="MsoNormal" style="text-align: left;"> </p> 
  <p class="MsoNormal" style="text-align: left;"><strong><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">try</span></strong><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">{</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;"><span>&nbsp;</span></span><span style="font-family: 'Courier New'; color: #3f7f5f; font-size: 10pt;">//</span><span style="font-family: 宋体; color: #3f7f5f; font-size: 10pt;">获取请求报表组文件名</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;"><span>&nbsp;</span>request.setCharacterEncoding( </span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“GBK”</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;"> );</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;"><span>&nbsp;</span>String report = request.getParameter( </span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“rpg”</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;"> );</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">report = </span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“group.rpg”</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">StringBuffer param=</span><strong><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">new</span></strong><span style="font-family: 'Courier New'; color: black; font-size: 10pt;"> StringBuffer();</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">&nbsp;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">&nbsp;</span><span style="font-family: 'Courier New'; color: #3f7f5f; font-size: 10pt;">//</span><span style="font-family: 宋体; color: #3f7f5f; font-size: 10pt;">保证报表名称的完整性</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">&nbsp;</span><strong><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">int</span></strong><span style="font-family: 'Courier New'; color: black; font-size: 10pt;"> iTmp = 0;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">&nbsp;</span><strong><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">if</span></strong><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">( (iTmp = report.lastIndexOf(</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“.rpg”</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">)) &lt;= 0 ){</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">report = report + </span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“.rpg”</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">iTmp = 0;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">}</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">&nbsp;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">Context context = new Context();</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #3f7f5f; font-size: 10pt;">//</span><span style="font-family: 宋体; color: #3f7f5f; font-size: 10pt;">自定义数据源</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">con = ConnectDemo.getConnection();</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">context.setDefDataSourceName(</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“demo”</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">);</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">context.setConnection(</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“demo”</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">, con);</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">DataSourceConfig dsoc = </span><strong><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">new</span></strong><span style="font-family: 'Courier New'; color: black; font-size: 10pt;"> DataSourceConfig(DBTypes.UNKNOWN, </span><strong><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">true</span></strong><span style="font-family: 'Courier New'; color: black; font-size: 10pt;"></span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“GBK”</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;"></span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“GBK”</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;"></span><strong><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">false</span></strong><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">);</span><span style="font-family: 'Courier New'; color: #3f7f5f; font-size: 10pt;">//</span><span style="font-family: 宋体; color: #3f7f5f; font-size: 10pt;">数据库类型</span><span style="font-family: 'Courier New'; color: #3f7f5f; font-size: 10pt;">(DBTypes.UNKNOWN)</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">context.setDataSourceConfig(</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“demo”</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">, dsoc);</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">context.setDefDataSourceName(</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“demo”</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">);</span></p> 
  <p class="MsoNormal" style="text-align: left;">&nbsp;</p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">ReportGroup rg = ReportUtils2.readReportGroup(report, context);</span></p> 
  <p class="MsoNormal" style="text-align: left;">&nbsp;</p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">Enumeration paramNames = request.getParameterNames();</span></p> 
  <p class="MsoNormal" style="text-align: left;"><strong><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">if</span></strong><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">(paramNames!=</span><strong><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">null</span></strong><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">){</span></p> 
  <p class="MsoNormal" style="text-align: left;"><strong><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">while</span></strong><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">(paramNames.hasMoreElements()){</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">String paramName = (String) paramNames.nextElement();</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">String paramValue=request.getParameter(paramName);</span></p> 
  <p class="MsoNormal" style="text-align: left;"><strong><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">if</span></strong><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">(paramValue!=</span><strong><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">null</span></strong><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">){</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #3f7f5f; font-size: 10pt;">//</span><span style="font-family: 宋体; color: #3f7f5f; font-size: 10pt;">把参数拼成</span><span style="font-family: 'Courier New'; color: #3f7f5f; font-size: 10pt;">name=value;name2=value2;…..</span><span style="font-family: 宋体; color: #3f7f5f; font-size: 10pt;">的形式</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">param.append(paramName).append(</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“=”</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">).append(paramValue).append(</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“;”</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">);</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">}</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">}</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">}</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">request.setAttribute(</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“group”</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">,rg);</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #3f7f5f; font-size: 10pt;">//request.setAttribute(“contextName1″,context);</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">%&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"> </p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&lt;</span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">table </span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">id</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">rpt </span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">align</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">center</span><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&gt;&lt;</span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">tr</span><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&gt;&lt;</span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">td</span><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&lt;</span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">table </span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">align</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">center</span><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&lt;</span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">tr</span><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&gt;&lt;</span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">td</span><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&lt;</span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">report:group </span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">srcType</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“bean”</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">beanName</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“group”</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">params</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“</span><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">&lt;%=</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">param.toString() </span><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">%&gt;</span><span style="font-family: 'Courier New'; font-size: 10pt;">“</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">needPrint</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“no”</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">needSaveAsExcel</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“no”</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">needSaveAsPdf</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“no”</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">needSaveAsWord</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“no”</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">funcBarLocation</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“”</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">needPrint</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“no”</span></p> 
  <p class="MsoNormal" style="text-align: left;">&nbsp;</p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">/&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&lt;/</span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">td</span><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&gt;&lt;/</span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">tr</span><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&lt;/</span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">table</span><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">&lt;%</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">}</span><strong><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">catch</span></strong><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">(Exception e){</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">e.printStackTrace();</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">}</span><strong><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">finally</span></strong><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">{</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">con.close();</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">}</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #bf5f3f; font-size: 10pt;">%&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"> </p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&lt;/</span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">body</span><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&gt;</span></p> 
  <p class="MsoNormal"><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&lt;/</span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">html</span><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&gt;</span></p> 
  <p class="MsoNormal"> </p> 
  <p class="MsoNormal"><span style="font-family: 宋体; color: black; font-size: 10pt;">访问一下这个页面，问题出现了，如下图：</span></p> 
  <p class="MsoNormal"> </p> 
  <p class="MsoNormal"><img class="alignnone size-full wp-image-6594" title="14" src="http://www.runqian.com.cn/know-how/wp-content/uploads/2011/02/14.jpg" alt="14" width="554" height="207" /></p> 
  <p class="MsoNormal"><span style="font-family: 宋体; color: black; font-size: 10pt;">这样实现的确有问题，但是问题到底出在哪呢？</span></p> 
  <p class="MsoNormal" style="text-indent: 21pt;"><span style="font-family: 宋体; color: black; font-size: 10pt;">经过分析我们发现，报表组中因为不存在类似单独报表的</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">beanName</span><span style="font-family: 宋体; color: black; font-size: 10pt;">这样的标签，所以在报表发布的时候无法找到当前上下文，也就无法取得上面设置的数据源了。如果能有一个上下文根，我们将数据源放入其中，那么在任何需要的时候就都能取得了。其实润乾是有这样的函数的。</span></p> 
  <h2><span style="font-family: 宋体;">解决步骤</span></h2> 
  <p class="MsoNormal"><span style="font-family: 宋体;">我们将上述程序中的</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">Context context = new Context();</span><span style="font-family: 宋体; color: black; font-size: 10pt;">修改为：</span><span style="font-family: 'Courier New'; background: blue; color: black; font-size: 10pt;">Context context<span> </span>= Context.getInitCtx();</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;"> </span><span style="font-family: 宋体; color: black; font-size: 10pt;">即可。</span></p> 
  <p class="MsoNormal"><span style="font-family: 宋体; color: black; font-size: 10pt;">查看</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">API</span><span style="font-family: 宋体; color: black; font-size: 10pt;">看一下这个函数的具体含义：</span></p> 
  <p class="MsoNormal"> </p> 
  <p class="MsoNormal"><span style="font-family: 宋体; color: black; font-size: 10pt;"><img class="alignnone size-full wp-image-6595" title="15" src="http://www.runqian.com.cn/know-how/wp-content/uploads/2011/02/15.jpg" alt="15" width="554" height="159" />所以，它正是我们所需要的。</span></p> 
  <p class="MsoNormal"> </p> 
  <p class="MsoNormal"><span style="font-family: 宋体;">最后，我们看一下，修改后页面展示的效果：</span></p> 
  <p class="MsoNormal"><span><img class="alignnone size-full wp-image-6596" title="16" src="http://www.runqian.com.cn/know-how/wp-content/uploads/2011/02/16.jpg" alt="16" width="554" height="261" /></span></p>  
 </body>
</html>