<html>
 <head></head> 
 <body> 
  <h2><span style="font-family: 宋体;">需求背景</span></h2> 
  <p class="MsoNormal"><span style="font-family: 宋体;">润乾报表提供的单元格</span><span>sum</span><span style="font-family: 宋体;">函数能方便地求得报表各个单元格的和，由于</span><span>sum</span><span style="font-family: 宋体;">函数属于数学函数，结果必然也是数值，所以</span><span>sum</span><span style="font-family: 宋体;">空值的结果是</span><span>0.0</span><span style="font-family: 宋体;">。</span></p> 
  <p class="MsoNormal"><span style="font-family: 宋体;">最近有的客户提出这样的需求：当要求和的单元格都为空时，显示空；当只有空和</span><span>0</span><span style="font-family: 宋体;">时，显示</span><span>0</span><span style="font-family: 宋体;">；当存在正常的数字时，得到相应的和。对于这个需求本文中给出如下两种实现方法。</span></p> 
  <h2><span style="font-family: 宋体;">实现方法</span></h2> 
  <h3><span style="font-family: 宋体;">通过</span><span>JS</span><span style="font-family: 宋体;">实现</span></h3> 
  <p class="MsoNormal"><span style="font-family: 宋体;">首先看一下报表，见下图。其中</span><span>C3</span><span style="font-family: 宋体;">是我们要显示“乡村人口”的总和，即需求提到的效果。</span><span>C1</span><span style="font-family: 宋体;">用于</span><span>js</span><span style="font-family: 宋体;">中读取乡村人口字段所有值，设置为不可扩展。</span></p> 
  <p class="MsoNormal"> </p> 
  <p class="MsoNormal"><img class="alignnone size-full wp-image-6616" title="22" src="http://www.runqian.com.cn/know-how/wp-content/uploads/2011/02/22.jpg" alt="22" width="554" height="192" /></p> 
  <p class="MsoNormal"><span style="font-family: 宋体;">在发布该报表的</span><span>jsp</span><span style="font-family: 宋体;">中增加如下</span><span>js</span><span style="font-family: 宋体;">代码</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&lt;</span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">script </span><span style="font-family: 'Courier New'; color: #7f007f; font-size: 10pt;">language</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">=</span><span style="font-family: 'Courier New'; color: #2a00ff; font-size: 10pt;">“javascript”</span><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&gt;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">var </span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">value = document.getElementById(</span><span style="font-family: 'Courier New'; color: #8e00ff; font-size: 10pt;">“report1_C1″</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">).innerText;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">var </span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">arr_people = value.split(</span><span style="font-family: 'Courier New'; color: #8e00ff; font-size: 10pt;">“,”</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">);</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">var </span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">flag1 = 0;<span> </span></span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">//null</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">标识位</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">var </span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">flag2 = 0;<span> </span></span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">//0</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">标识位</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">var </span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">sumValue = 0;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">for</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">(</span><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">var </span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">i=0;i&lt;arr_people.length;i++)</span><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">{</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">if</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">(arr_people[i]==</span><span style="font-family: 'Courier New'; color: #8e00ff; font-size: 10pt;">‘null’</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">)</span><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">{</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">flag1=1;<span> </span></span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">//</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">当有值为</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">null</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">时，空标识位为</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">1</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">//alert(“flag1=”+flag1);</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">}else if</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">(arr_people[i]==</span><span style="font-family: 'Courier New'; color: #8e00ff; font-size: 10pt;">’0′</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">)</span><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">{</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">flag2=1;<span> </span></span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">//</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">当有值为</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">0</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">时，</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">0</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">标识位为</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">1</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">}else{</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">flag1=2;<span> </span></span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">//</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">出现非</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">0</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">非</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">null</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">时，空标志位为</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">2</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">flag2=2;<span> </span></span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">//</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">出现非</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">0</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">非</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">null</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">时，</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">0</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">标识位为</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">2</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">break</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">;<span> </span></span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">//</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">出现非</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">0</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">非</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">null</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">时</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">,</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">退出循环</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">}</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">}</span></p> 
  <p class="MsoNormal" style="text-align: left;"> </p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">for</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">(</span><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">var </span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">i=0;i&lt;arr_people.length;i++)</span><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">{</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">if</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">(arr_people[i]!=</span><span style="font-family: 'Courier New'; color: #8e00ff; font-size: 10pt;">‘null’</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">)</span><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">{</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">sumValue+=parseFloat(arr_people[i]);<span> </span></span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">//</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">求非空数据和</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">}</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">}</span></p> 
  <p class="MsoNormal" style="text-align: left;"> </p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">if</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">(flag1==1 &amp;&amp; flag2==0)</span><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">{</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">//</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">全部为</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">null</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">时</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">document.getElementById(</span><span style="font-family: 'Courier New'; color: #8e00ff; font-size: 10pt;">“report1_C3″</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">).innerHTML=</span><span style="font-family: 'Courier New'; color: #8e00ff; font-size: 10pt;">”</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">}else if</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">(flag1!=2 &amp;&amp; flag2==1)</span><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">{</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">//</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">全部为空或</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">0</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">时</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">document.getElementById(</span><span style="font-family: 'Courier New'; color: #8e00ff; font-size: 10pt;">“report1_C3″</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">).innerHTML=</span><span style="font-family: 'Courier New'; color: #8e00ff; font-size: 10pt;">’0′</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">}else{</span><span style="font-family: 'Courier New'; color: #3f5fbf; font-size: 10pt;">//</span><span style="font-family: 宋体; color: #3f5fbf; font-size: 10pt;">存在数字时</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">document.getElementById(</span><span style="font-family: 'Courier New'; color: #8e00ff; font-size: 10pt;">“report1_C3″</span><span style="font-family: 'Courier New'; color: black; font-size: 10pt;">).innerHTML=sumValue;</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 'Courier New'; color: #7f0055; font-size: 10pt;">}</span></p> 
  <p class="MsoNormal"><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&lt;/</span><span style="font-family: 'Courier New'; color: #3f7f7f; font-size: 10pt;">script</span><span style="font-family: 'Courier New'; color: teal; font-size: 10pt;">&gt;</span></p> 
  <p class="MsoNormal"> </p> 
  <p class="MsoNormal" style="text-indent: 21pt;"><span style="font-family: 宋体;">此实现方式比较固定，所以如果要显示的单元格比较多时，比较麻烦。好处是在程序中处理业务会比报表更灵活。</span></p> 
  <p class="MsoNormal"> </p> 
  <h3><span style="font-family: 宋体;">通过报表表达式实现</span></h3> 
  <p class="MsoNormal"><span style="font-family: 宋体;">在</span><span>C3</span><span style="font-family: 宋体;">单元格的显示值表达式中写入：</span><span>if(ds1.count(</span><span style="font-family: 宋体;">乡村人口</span><span>==null)==ds1.count(),”&quot;,value())<span> <img class="alignnone size-full wp-image-6617" title="23" src="http://www.runqian.com.cn/know-how/wp-content/uploads/2011/02/23.jpg" alt="23" width="554" height="231" /></span></span></p> 
  <p class="MsoNormal"><span style="font-family: 宋体; font-size: 10.5pt;">此方法实现简单，适合大量单元格使用，缺点就是没有程序处理灵活。</span></p>  
 </body>
</html>