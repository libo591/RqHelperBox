<html>
 <head></head> 
 <body> 
  <p>由于行式填报在导入excel的数据量比较大的时候，页面加载数据会很慢，在这种情况下可以采取后台直接导入数据库的方法，实例如下：</p> 
  <p>package example;<br /> import java.sql.Connection;<br /> import java.sql.Driver;<br /> import java.sql.DriverManager;<br /> import java.text.SimpleDateFormat;<br /> import java.util.Locale;</p> 
  <p>import com.runqian.base4.resources.FormatUtils;<br /> import com.runqian.report4.ide.ExcelImporter;<br /> import com.runqian.report4.input.DataSaver;<br /> import com.runqian.report4.input.RowReportSaver;<br /> import com.runqian.report4.model.ReportDefine;<br /> import com.runqian.report4.model.engine.ExtCellSet;<br /> import com.runqian.report4.model.engine2.RowReport;<br /> import com.runqian.report4.usermodel.Area;<br /> import com.runqian.report4.usermodel.Context;<br /> import com.runqian.report4.usermodel.DataSourceConfig;<br /> import com.runqian.report4.usermodel.Engine;<br /> import com.runqian.report4.usermodel.INormalCell;<br /> import com.runqian.report4.usermodel.IReport;<br /> import com.runqian.report4.usermodel.input.InputProperty;<br /> import com.runqian.report4.util.ReportUtils;</p> 
  <p>public class DateFromExcel2 {</p> 
  <p>Context cxt = null;</p> 
  <p>public void saveFromExcel(String reportFile, String excelFile, int sheetNum)<br /> throws Exception {<br /> IReport report = calcReport(reportFile); //计算出填报表<br /> RowReport rr = ( RowReport ) report;<br /> String did = rr.getDetailID( 2 ); //第二行是扩展主行<br /> //System.out.println(”did–&gt;”+did);<br /> SimpleDateFormat dateF = new SimpleDateFormat( FormatUtils.getDateFormat( Locale.getDefault() ) );<br /> SimpleDateFormat timeF = new SimpleDateFormat( FormatUtils.getTimeFormat( Locale.getDefault() ) );<br /> SimpleDateFormat datetimeF = new SimpleDateFormat( FormatUtils.getDatetimeFormat( Locale.getDefault() ) );<br /> //System.out.println(”datef-&gt;”+dateF);<br /> //System.out.println(”timeF-&gt;”+timeF);<br /> //System.out.println(”datetimeF-&gt;”+datetimeF);<br /> RowReportSaver rowSaver = new RowReportSaver( rr, null, cxt );<br /> IReport excelReport = excelToReport(excelFile,sheetNum);<br /> //int rows = excelReport.getRowCount();<br /> //short cols = excelReport.getColCount();<br /> //if(rows&gt;report.getRowCount()) rows = report.getRowCount();<br /> //if(cols&gt;report.getColCount()) cols = report.getColCount();<br /> for(int i=2;i&lt;=excelReport.getRowCount();i++){ ////逐行逐列把excel数据写入填报表<br /> Area area = rr.insertDetail( did );<br /> for(int j=1;j&lt;=excelReport.getColCount();j++){<br /> INormalCell iExcelCell=excelReport.getCell(i, (short)j); //取得excel单元格<br /> //System.out.println(”iExcelCell.getValue()–&gt;”+iExcelCell.getValue());</p> 
  <p>//System.out.println(”area.getBeginRow()–&gt;”+area.getBeginRow());<br /> //System.out.println(”i-&gt;”+i);<br /> //System.out.println(”(short)j-&gt;”+(short)j);<br /> if( iExcelCell == null ) continue;<br /> String svalue = “”;<br /> Object value = iExcelCell.getValue();<br /> if( value != null ) svalue = value.toString();<br /> System.out.println(”svale-&gt;”+svalue);<br /> rowSaver.setCellInputValue( area.getBeginRow(), (short)j, svalue, dateF, timeF, datetimeF );<br /> }<br /> }<br /> //ReportUtils.write(”c:/qq.raq”,report);<br /> rowSaver.save();<br /> }</p> 
  <p>private IReport calcReport(String reportFile) throws Exception {<br /> ReportDefine rd = (ReportDefine) ReportUtils.read(reportFile);<br /> cxt = new Context();</p> 
  <p>Connection connection = null;<br /> try {<br /> Driver driver = (Driver) Class.forName(”org.hsqldb.jdbcDriver”)<br /> .newInstance();<br /> DriverManager.registerDriver(driver);<br /> connection = DriverManager.getConnection(<br /> “jdbc:hsqldb:hsql://localhost/runqianDB”, “sa”, “”);<br /> } catch (Exception e) {<br /> e.printStackTrace();<br /> }</p> 
  <p>// 设置数据源,动态改变连接参数<br /> cxt.setDefDataSourceName(”demo”);<br /> // 设置数据连接,也可以设置连接池工厂,如cxt.setConnectionFactory(sourceName,connectionFactory)<br /> // 其中connectionFactory这个类必须implements IConnectionFactory,并且实现他的public<br /> // java.sql.Connection getConnection() throws Exception 方法<br /> cxt.setConnection(”demo”, connection);<br /> DataSourceConfig dsoc = new DataSourceConfig(2, true, “GBK”, “GBK”,<br /> false);<br /> cxt.setDataSourceConfig(”demo”, dsoc);</p> 
  <p>Engine engine = new Engine(rd, cxt);<br /> IReport iReport = engine.calc();<br /> return iReport;</p> 
  <p>} private IReport excelToReport(String excelFile, int sheetNum)<br /> throws Exception {<br /> ExcelImporter ei = new ExcelImporter(excelFile);<br /> return ei.getReport(sheetNum);<br /> }</p> 
  <p>public static void main(String[] args){<br /> String license = “D:\\software\\tomcat\\tomcat5.0.28\\webapps\\report4\\WEB-INF\\2009-03-31V4.0Windows.lic”;<br /> String reportFile = “D:\\software\\tomcat\\tomcat5.0.28\\webapps\\report4\\reportFiles\\newapi\\input.raq”;<br /> String excelFile = “D:\\software\\tomcat\\tomcat5.0.28\\webapps\\report4\\reportFiles\\newapi\\input.xls”;<br /> int sheetNum = 0;<br /> DateFromExcel2 dexcel = new DateFromExcel2();<br /> ExtCellSet.setLicenseFileName( license );<br /> try {<br /> dexcel.saveFromExcel(reportFile,excelFile,sheetNum);<br /> } catch (Exception ex) {<br /> // TODO Auto-generated catch block<br /> ex.printStackTrace();<br /> }<br /> }</p> 
  <p>}</p> 
  <p>然后在前台页面上设置一个按钮来调用这个后台类,就可以实现行式填报表导入excel直接保存数据入库的功能了. </p>  
 </body>
</html>