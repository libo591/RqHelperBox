<html>
 <head></head> 
 <body> 
  <p class="MsoNormal"><span><span style="FONT-FAMILY: 宋体">在做填报表时，可能会遇到这样的需求，某个单元格值发生变化后，其他一些单元格值也跟着发生变化，就是局部刷新报表。如果是简单的加减乘除运算，可以在单元格的自动计算里面实现；如果关联单元格显示的内容是从数据库中取出来的，就不能写加减乘除表达式来实现了，需要用</span><span>ajax</span></span><span><span style="FONT-FAMILY: 宋体">来实现。</span></span></p> 
  <p class="MsoNormal"><span><span style="FONT-FAMILY: 宋体">比如一个货物订单表，当选择完产品后，产品的单价、库存量自动填充，然后用户根据这些信息填写订货量。</span></span></p> 
  <p class="MsoNormal"><span><span><img src="http://www.runqian.com.cn/wp-content/uploads/2012/07/zrclip_006n778a0975.png" height="135" width="516" /></span></span></p> 
  <p class="MsoNormal"> </p> 
  <p class="MsoNormal"><span><span style="FONT-FAMILY: 宋体">实现思路：</span></span></p> 
  <p class="MsoNormal"><span><span style="FONT-FAMILY: 宋体">利用报表单元格的自动计算功能完成不同单元格信息的自动关联，自动计算表达式采用的是</span><span>js</span></span><span><span style="FONT-FAMILY: 宋体">函数，</span><span>js</span></span><span><span style="FONT-FAMILY: 宋体">函数中调用</span><span>ajax</span></span><span><span style="FONT-FAMILY: 宋体">，</span><span>ajax</span></span><span><span style="FONT-FAMILY: 宋体">中调用</span><span>servlet</span></span><span><span style="FONT-FAMILY: 宋体">查询数据库检索订单、库存量信息，返回给相应的单元格。</span></span></p> 
  <p class="MsoNormal"> </p> 
  <p class="MsoNormal"><span><span style="FONT-FAMILY: 宋体">实现过程：</span></span></p> 
  <p class="MsoNormal"><span><span style="FONT-FAMILY: 宋体">制作上面的报表，</span><span>A3</span></span><span><span style="FONT-FAMILY: 宋体">单元格设置下拉数据集，用来选择产品，在</span><span>B3</span></span><span><span style="FONT-FAMILY: 宋体">单元格自动计算里面设置表达式”</span><span>getValue(“</span></span><span><span style="FONT-FAMILY: 宋体">单价</span><span>“,A3)</span></span><span><span style="FONT-FAMILY: 宋体">“（第一个参数是要查询的字段，第二个参数是关联的单元格，返回数据库中</span><span>A3</span></span><span><span style="FONT-FAMILY: 宋体">选择的产品对应的单价），</span><span>C3</span></span><span><span style="FONT-FAMILY: 宋体">单元格自动计算的表达式”</span><span>getValue(“</span></span><span><span style="FONT-FAMILY: 宋体">库存量</span><span>“,A3)</span></span><span><span style="FONT-FAMILY: 宋体">“，单元格</span><span>D3</span></span><span><span style="FONT-FAMILY: 宋体">设置为可写。</span></span></p> 
  <p class="MsoNormal"> </p> 
  <p class="MsoNormal"><span><span style="FONT-FAMILY: 宋体">解析报表的</span><span>jsp</span></span><span><span style="FONT-FAMILY: 宋体">如下</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #bf5f3f; FONT-SIZE: 10pt">&lt;%@</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f7f7f; FONT-SIZE: 10pt">page</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f007f; FONT-SIZE: 10pt">contentType</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">=</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #2a00ff; FONT-SIZE: 10pt">“text/html; charset=GBK”</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #bf5f3f; FONT-SIZE: 10pt">%&gt;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #bf5f3f; FONT-SIZE: 10pt">&lt;%@</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f7f7f; FONT-SIZE: 10pt">taglib</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f007f; FONT-SIZE: 10pt">uri</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">=</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #2a00ff; FONT-SIZE: 10pt">“/WEB-INF/runqianReport4.tld”</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f007f; FONT-SIZE: 10pt">prefix</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">=</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #2a00ff; FONT-SIZE: 10pt">“report”</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #bf5f3f; FONT-SIZE: 10pt">%&gt;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: teal; FONT-SIZE: 10pt">&lt;</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f7f7f; FONT-SIZE: 10pt">html</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: teal; FONT-SIZE: 10pt">&gt;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: teal; FONT-SIZE: 10pt">&lt;</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f7f7f; FONT-SIZE: 10pt">body</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: teal; FONT-SIZE: 10pt">&gt;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #bf5f3f; FONT-SIZE: 10pt">&lt;%</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">request.setCharacterEncoding(</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #2a00ff; FONT-SIZE: 10pt">“GBK”</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">);</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #bf5f3f; FONT-SIZE: 10pt">%&gt;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: teal; FONT-SIZE: 10pt">&lt;</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f7f7f; FONT-SIZE: 10pt">report:html</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f007f; FONT-SIZE: 10pt">name</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">=</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #2a00ff; FONT-SIZE: 10pt">“report1″</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f007f; FONT-SIZE: 10pt">reportFileName</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">=</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #2a00ff; FONT-SIZE: 10pt">“testAjax.raq”</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: teal; FONT-SIZE: 10pt">/&gt;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"> </p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: teal; FONT-SIZE: 10pt">&lt;</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f7f7f; FONT-SIZE: 10pt">script</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f007f; FONT-SIZE: 10pt">language</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">=</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #2a00ff; FONT-SIZE: 10pt">“javascript”</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: teal; FONT-SIZE: 10pt">&gt;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">var</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">xmlHttp;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">var</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">result;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f5fbf; FONT-SIZE: 10pt">//</span></span><span><span style="FONT-FAMILY: 宋体; COLOR: #3f5fbf; FONT-SIZE: 10pt">初试化</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f5fbf; FONT-SIZE: 10pt">XMLHttpRequest</span></span><span><span style="FONT-FAMILY: 宋体; COLOR: #3f5fbf; FONT-SIZE: 10pt">对象</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">function</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">createXMLHttpRequest()</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">{</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">if</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">(window.ActiveXObject)</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">{</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">xmlHttp=</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">new</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">ActiveXObject(</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #8e00ff; FONT-SIZE: 10pt">“Microsoft.XMLHTTP”</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">);</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">}else if</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">(window.XMLHttpRequest)</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">{</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">xmlHttp=</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">new</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">XMLHttpRequest();</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">}</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">}</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">function</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">call()</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">{</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">if</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">(xmlHttp.readyState == 4)</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">{</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f5fbf; FONT-SIZE: 10pt">//</span></span><span><span style="FONT-FAMILY: 宋体; COLOR: #3f5fbf; FONT-SIZE: 10pt">响应内容解析完成，可以在客户端调用了</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">if</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">(xmlHttp.status == 200)</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">{</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f5fbf; FONT-SIZE: 10pt">//http</span></span><span><span style="FONT-FAMILY: 宋体; COLOR: #3f5fbf; FONT-SIZE: 10pt">请求一切正常，对</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f5fbf; FONT-SIZE: 10pt">GET</span></span><span><span style="FONT-FAMILY: 宋体; COLOR: #3f5fbf; FONT-SIZE: 10pt">和</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f5fbf; FONT-SIZE: 10pt">POST</span></span><span><span style="FONT-FAMILY: 宋体; COLOR: #3f5fbf; FONT-SIZE: 10pt">请求的应答文档跟在后面</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">result = decodeURI(xmlHttp.responseText);</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">}</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">}</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">}</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f5fbf; FONT-SIZE: 10pt">//</span></span><span><span style="FONT-FAMILY: 宋体; COLOR: #3f5fbf; FONT-SIZE: 10pt">根据关联单元格、字段名称返回该字段的值</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">function</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">getValue(field, orderID)</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">{</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f5fbf; FONT-SIZE: 10pt">//alert(“aa”);</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">createXMLHttpRequest();</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">var</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">url=</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #8e00ff; FONT-SIZE: 10pt">“</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #bf5f3f; FONT-SIZE: 10pt">&lt;%=</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">request.getContextPath()</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #bf5f3f; FONT-SIZE: 10pt">%&gt;</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #8e00ff; FONT-SIZE: 10pt">/ajax_Servlet2?selectField=”</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">+ field +</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #8e00ff; FONT-SIZE: 10pt">“&amp;orderID=”</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">+ orderID;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">xmlHttp.onreadystatechange = call;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">xmlHttp.open(</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #8e00ff; FONT-SIZE: 10pt">“GET”</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">, url,</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">false</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">);</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">xmlHttp.send(</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">null</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">);</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">return</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">result;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">}</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: teal; FONT-SIZE: 10pt">&lt;/</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f7f7f; FONT-SIZE: 10pt">script</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: teal; FONT-SIZE: 10pt">&gt;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: teal; FONT-SIZE: 10pt">&lt;/</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f7f7f; FONT-SIZE: 10pt">body</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: teal; FONT-SIZE: 10pt">&gt;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: teal; FONT-SIZE: 10pt">&lt;/</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #3f7f7f; FONT-SIZE: 10pt">html</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: teal; FONT-SIZE: 10pt">&gt;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"> </p> 
  <p class="MsoNormal"><span><span>Servlet</span></span><span><span style="FONT-FAMILY: 宋体">如下：</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">public</span></strong></span><span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">class</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">AjaxServlet_2</span></span> <span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">extends</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">HttpServlet{</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">Connection</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #0000c0; FONT-SIZE: 10pt">conn</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">Statement</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #0000c0; FONT-SIZE: 10pt">stmt</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">ResultSet</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #0000c0; FONT-SIZE: 10pt">rs</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">public</span></strong></span><span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">void</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">doGet(HttpServletRequest request, HttpServletResponse response)</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">throws</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">ServletException, IOException{</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">response.setCharacterEncoding(</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #2a00ff; FONT-SIZE: 10pt">“GBK”</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">);</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">Context ctx = Context.<em>getInitCtx</em>();</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">try</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">{</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #0000c0; FONT-SIZE: 10pt">conn</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">= ctx.getConnectionFactory(ctx.getDefDataSourceName()).getConnection();</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #0000c0; FONT-SIZE: 10pt">stmt</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">=</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #0000c0; FONT-SIZE: 10pt">conn</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">.createStatement();</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">}</span></span> <span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">catch</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">(Exception e) {</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">e.printStackTrace();</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">}</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">String selectField = request.getParameter(</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #2a00ff; FONT-SIZE: 10pt">“selectField”</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">);</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">String orderID = request.getParameter(</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #2a00ff; FONT-SIZE: 10pt">“orderID”</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">);</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">if</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">(!</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #2a00ff; FONT-SIZE: 10pt">“”</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">.equals(selectField) || selectField ==</span></span> <span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">null</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">){</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">String selectSQL =</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #2a00ff; FONT-SIZE: 10pt">“SELECT “</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">+ selectField +</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #2a00ff; FONT-SIZE: 10pt">” FROM</span></span> <span><span style="FONT-FAMILY: 宋体; COLOR: #2a00ff; FONT-SIZE: 10pt">产品</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #2a00ff; FONT-SIZE: 10pt">where</span></span> <span><span style="FONT-FAMILY: 宋体; COLOR: #2a00ff; FONT-SIZE: 10pt">产品</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #2a00ff; FONT-SIZE: 10pt">ID=”</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">+ orderID;</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">try</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">{</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #0000c0; FONT-SIZE: 10pt">rs</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">=</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #0000c0; FONT-SIZE: 10pt">stmt</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">.executeQuery(selectSQL);</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">if</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">(</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #0000c0; FONT-SIZE: 10pt">rs</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">.next()){</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">PrintWriter out=response.getWriter();</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">out.write(URLEncoder.<em>encode</em>(</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #0000c0; FONT-SIZE: 10pt">rs</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">.getString(selectField).trim(),</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #2a00ff; FONT-SIZE: 10pt">“UTF-8″</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">));</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">out.flush();</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">out.close();</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">}</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">}</span></span> <span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">catch</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">(SQLException e) {</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">e.printStackTrace();</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">}</span></span><span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">finally</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">{</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">try</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">{</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">if</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">(</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #0000c0; FONT-SIZE: 10pt">stmt</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">!=</span></span> <span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">null</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">)</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #0000c0; FONT-SIZE: 10pt">stmt</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">.close();</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">if</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">(</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #0000c0; FONT-SIZE: 10pt">rs</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">!=</span></span> <span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">null</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">)</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #0000c0; FONT-SIZE: 10pt">rs</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">.close();</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">if</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">(</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: #0000c0; FONT-SIZE: 10pt">conn</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">!=</span></span> <span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">null</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">)</span></span> <span><span style="FONT-FAMILY: 'Courier New'; COLOR: #0000c0; FONT-SIZE: 10pt">conn</span></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">.close();</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">}</span></span> <span><strong><span style="FONT-FAMILY: 'Courier New'; COLOR: #7f0055; FONT-SIZE: 10pt">catch</span></strong></span><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">(SQLException e) {</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">e.printStackTrace();</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">}</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">}</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">}</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">}</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 'Courier New'; COLOR: black; FONT-SIZE: 10pt">}</span></span></p> 
  <p style="TEXT-ALIGN: left" class="MsoNormal"><span><span style="FONT-FAMILY: 宋体; FONT-SIZE: 10pt">页面效果如下</span></span></p> 
  <p style="MARGIN: 0cm -24.15pt 0pt 0pt" class="MsoNormal"><span><span><img src="http://www.runqian.com.cn/wp-content/uploads/2012/07/zrclip_007n5a27e2e8.png" height="115" width="313" /> <br /></span></span></p> 
  <p style="MARGIN: 0cm -24.15pt 0pt 0pt" class="MsoNormal"><span><span style="FONT-FAMILY: 宋体">上图中选择了”大众奶酪”，当产品名称列失去焦点后，效果如下</span></span></p> 
  <p style="MARGIN: 0cm -24.15pt 0pt 0pt" class="MsoNormal"><span><span><img src="http://www.runqian.com.cn/wp-content/uploads/2012/07/zrclip_008p30647446.png" height="115" width="310" /> <br /></span></span></p> 
  <p style="MARGIN: 0cm -24.15pt 0pt 0pt" class="MsoNormal"><span><span style="FONT-FAMILY: 宋体">上面的方法就可以实现用</span><span>ajax</span></span><span><span style="FONT-FAMILY: 宋体">自动填充关联单元格，方法比较简单，实现报表的局部刷新。</span></span></p>  
 </body>
</html>