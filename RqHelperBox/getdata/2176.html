<html>
 <head></head> 
 <body> 
  <p>近一段时间在解决客户问题的过程中，遇到这样一个需求：客户数据库中的某个字段中存的是html类型的数据，是html类型的table，客户希望将这样的table放到报表的单元格中展现，让单元格自适应html里面table的大小，让整个table完全展现。</p> 
  <p>润乾报表里面的自动换行不能实现客户的需求，需要采取其他的办法，让报表识别出html的table哪里需要换行，从而对单元格的内容进行换行。</p> 
  <p>下面就用一个例子实现上面的需求。</p> 
  <p><strong>第一步，设计一张报表：</strong></p> 
  <p>首先制作一张内建数据的报表，数据集的内容是一个html的table，这里取如下的内容：</p> 
  <p class="MsoNormal"><span style="color: navy;"><span style="color: navy;"><span style="color: #000000;"><span style="color: navy;"><span style="background-color: #ffffff; color: #000000;"><span style="color: navy;"><span style="color: #000000;"><span style="color: navy;">&lt;div class=”HtmlContainer”&gt;</span></span> &lt;<span style="color: #000000;">table border=”1″ cellpadding</span>=”0″ cellspace=”0″ width=”300″ align=”center”&gt;</span> &lt;tr&gt; &lt;td style=”width:60px”&gt;<span style="font-family: 宋体; color: navy;">姓名</span><span style="color: navy;">&lt;/td&gt;</span> &lt;td&gt;&lt;span style=”color:red”&gt;<span style="font-family: 宋体; color: navy;">成龙</span><span style="color: navy;">&lt;/span&gt;&lt;/td&gt;</span> &lt;td style=”width:60px”&gt;<span style="font-family: 宋体; color: navy;">主页</span><span style="color: navy;">&lt;/td&gt;</span> &lt;td&gt;&lt;a href=”www.chenglong.com”&gt;<span style="font-family: 宋体; color: navy;">成龙在线</span><span style="color: navy;">&lt;/a&gt;&lt;/td&gt;</span> &lt;/tr&gt; &lt;tr&gt; &lt;td style=”width:60px”&gt;<span style="font-family: 宋体; color: navy;">姓名</span><span style="color: navy;">&lt;/td&gt;</span> &lt;td&gt;&lt;span style=”color:red”&gt;<span style="font-family: 宋体; color: navy;">成龙</span><span style="color: navy;">&lt;/span&gt;&lt;/td&gt;</span> &lt;td style=”width:60px”&gt;<span style="font-family: 宋体; color: navy;">主页</span><span style="color: navy;">&lt;/td&gt;</span> &lt;td&gt;&lt;a href=”www.chenglong.com”&gt;<span style="font-family: 宋体; color: navy;">成龙在线</span><span style="color: navy;">&lt;/a&gt;&lt;/td&gt;</span> &lt;/tr&gt; &lt;tr&gt; &lt;td style=”width:60px”&gt;<span style="font-family: 宋体; color: navy;">姓名</span><span style="color: navy;">&lt;/td&gt;</span> &lt;td&gt;&lt;span style=”color:red”&gt;<span style="font-family: 宋体; color: navy;">成龙</span><span style="color: navy;">&lt;/span&gt;&lt;/td&gt;</span> &lt;td style=”width:60px”&gt;<span style="font-family: 宋体; color: navy;">主页</span><span style="color: navy;">&lt;/td&gt;</span> &lt;td&gt;&lt;a href=”www.chenglong.com”&gt;<span style="font-family: 宋体; color: navy;">成龙在线</span><span style="color: navy;">&lt;/a&gt;&lt;/td&gt;</span> &lt;/tr&gt; &lt;tr&gt; &lt;td style=”width:60px”&gt;<span style="font-family: 宋体; color: navy;">姓名</span><span style="color: navy;">&lt;/td&gt;</span> &lt;td&gt;&lt;span style=”color:red”&gt;<span style="font-family: 宋体; color: navy;">成龙</span><span style="color: navy;">&lt;/span&gt;&lt;/td&gt;</span> &lt;td style=”width:60px”&gt;<span style="font-family: 宋体; color: navy;">主页</span><span style="color: navy;">&lt;/td&gt;</span> &lt;td&gt;&lt;a href=”www.chenglong.com”&gt;<span style="font-family: 宋体; color: navy;">成龙在线</span><span style="color: navy;">&lt;/a&gt;&lt;/td&gt;</span> &lt;/tr&gt; &lt;tr&gt; &lt;td style=”width:60px”&gt;<span style="font-family: 宋体; color: navy;">姓名</span><span style="color: navy;">&lt;/td&gt;</span> &lt;td&gt;&lt;span style=”color:red”&gt;<span style="font-family: 宋体; color: navy;">成龙</span><span style="color: navy;">&lt;/span&gt;&lt;/td&gt;</span> &lt;td style=”width:60px”&gt;<span style="font-family: 宋体; color: navy;">主页</span><span style="color: navy;">&lt;/td&gt;</span> &lt;td&gt;&lt;a href=”www.chenglong.com”&gt;<span style="font-family: 宋体; color: navy;">成龙在线</span><span style="color: navy;">&lt;/a&gt;&lt;/td&gt;</span> &lt;/tr&gt; &lt;tr&gt; &lt;td style=”width:60px”&gt;<span style="font-family: 宋体; color: navy;">姓名</span><span style="color: navy;">&lt;/td&gt;</span> &lt;td&gt;&lt;span style=”color:red”&gt;<span style="font-family: 宋体; color: navy;">成龙</span><span style="color: navy;">&lt;/span&gt;&lt;/td&gt;</span> &lt;td style=”width:60px”&gt;<span style="font-family: 宋体; color: navy;">主页</span><span style="color: navy;">&lt;/td&gt;</span> &lt;td&gt;&lt;a href=”www.chenglong.com”&gt;<span style="font-family: 宋体; color: navy;">成龙在线</span><span style="color: navy;">&lt;/a&gt;&lt;/td&gt;</span> &lt;/tr&gt; &lt;tr&gt; &lt;td style=”width:60px”&gt;<span style="font-family: 宋体; color: navy;">姓名</span><span style="color: navy;">&lt;/td&gt;</span> &lt;td&gt;&lt;span style=”color:red”&gt;<span style="font-family: 宋体; color: navy;">成龙</span><span style="color: navy;">&lt;/span&gt;&lt;/td&gt;</span> &lt;td style=”width:60px”&gt;<span style="font-family: 宋体; color: navy;">主页</span><span style="color: navy;">&lt;/td&gt;</span> &lt;td&gt;&lt;a href=”www.chenglong.com”&gt;<span style="font-family: 宋体; color: navy;">成龙在线</span><span style="color: navy;">&lt;/a&gt;&lt;/td&gt;</span> &lt;/tr&gt; &lt;/table&gt; &lt;/div&gt;</span></span></span></span></span></p> 
  <p class="MsoNormal"><span style="color: navy;"><span style="font-family: 宋体; color: #000000;">然后制作这张报表，报表的样式和数据集的字段类型如下图所示：</span></span></p> 
  <p class="MsoNormal"><img src="http://www.runqian.com.cn/know-how/wp-content/uploads/2010/09/zrclip-008n6a7acbe7.png" alt="" width="554" height="317" /></p> 
  <p class="MsoNormal"><strong>第二步，根据<span>table</span><span style="font-family: 宋体;">的大小动态设置行高：</span></strong></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="font-family: 宋体;"><span style="font-family: 宋体;">选中如上图所示报表的第一行，也就是</span><span>html</span><span style="font-family: 宋体;">的</span><span>table</span><span style="font-family: 宋体;">所在的行，在对应行的行高处写表达式：</span><span style="color: navy;">count(split(rplc(ds1.select(test),”&lt;tr&gt;”,”|”),”|”))*8</span> <span style="font-family: 宋体;">这个表达式的含义是先将</span><span>html</span><span style="font-family: 宋体;">的</span><span>table</span><span style="font-family: 宋体;">中的</span><span>&lt;tr&gt;</span><span style="font-family: 宋体;">内容替换成竖线，也就是”</span><span>|</span><span style="font-family: 宋体;">“</span><span>,</span><span style="font-family: 宋体;">然后将</span><span>table</span><span style="font-family: 宋体;">的内容按竖线分割成一个数组元素，有多少个元素也就代表着</span><span>table</span><span style="font-family: 宋体;">有多少行，所以</span><span>count</span><span style="font-family: 宋体;">这个数组元素的个数，就取到了函数，根据需要</span><span>table</span><span style="font-family: 宋体;">中每行的高度设置成</span><span>8</span><span style="font-family: 宋体;">，所以整个的行高就是</span><span style="color: navy;">count(split(rplc(ds1.select(test),”&lt;tr&gt;”,”|”),”|”))*8</span></span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="color: #000000;">报表行高的设置方法如下图所示：</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="color: #000000;"><img src="http://www.runqian.com.cn/know-how/wp-content/uploads/2010/09/zrclip-009p61f17331.png" alt="" width="553" height="280" /></span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="color: #000000;"><strong>第三步：预览报表，查看效果：</strong></span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="color: #000000;">设计好报表后，点击设计器内的预览报表，就可以看到单元格自适应table的大小，table的内容能完全展现出来了，具体的效果如下图所示：</span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="color: #000000;"><img src="http://www.runqian.com.cn/know-how/wp-content/uploads/2010/09/zrclip-010p4d644731.png" alt="" width="553" height="325" /></span></p> 
  <p class="MsoNormal" style="text-align: left;"><span style="color: #000000;"><span style="font-family: 宋体;">如上图所示，整个</span><span>table</span><span style="font-family: 宋体;">的内容都完全展现出来了，这样报表单元格自动适应</span><span>table</span><span style="font-family: 宋体;">大小的功能就实现了。</span></span></p>  
 </body>
</html>