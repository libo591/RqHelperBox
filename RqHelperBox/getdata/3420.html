<html>
 <head></head> 
 <body> 
  <p>行式填报报表在与普通填报表最大的区别就是在填报的时候可以插入记录，当点击插入按钮的时候，可以通过流水号给新增数据赋默认值，也可以给报表所有的列都赋默认值，但是如果遇到比较复杂的需求，比如第一列自增，其他列取上一行的记录，这时候用流水号就需要写复杂的js了，而且效率也不理想，下面提供一个简单的方来解决上述需求。</p> 
  <p>思路，重写insertRow（）这个js，然后在页面调用这个新的js。进行插入。<br /> function _insertRow(table){<br /> if(confirm(”确定插入？”)==true){<br /> if( !_submitEditor( table ) ) return;<br /> if( table.currCell == null ) {<br /> alert( __UU );<br /> return;<br /> }<br /> var row = table.currCell.parentElement;<br /> if( !row.isDetail ) {<br /> alert( __VV );<br /> return;<br /> }<br /> var index = row.rowIndex;<br /> while( !row.isFirst ) {<br /> index–;<br /> row = table.rows[ index ];<br /> }<br /> _copyRows( table, row, index );<br /> _calcRowNoInGroup( table, row );<br /> }<br /> else{<br /> return false;<br /> }<br /> }</p> 
  <p>从上面的js中的_copyRows( table, row, index )这个函数实现的是复制行的功能，下面看一下这个js<br /> function _copyRows( table, baseRow, index ) {<br /> findRowNoInGroup( table, baseRow );<br /> var drows = parseInt( baseRow.drows );<br /> var baseRows = new Array( drows );<br /> baseRows[0] = baseRow;<br /> for( var i = 1; i &lt; drows; i++ ) {<br /> baseRows[i] = table.rows[ baseRow.rowIndex + i ];<br /> }<br /> var firstIndex;<br /> for( var i = 0; i &lt; drows; i++ ) {<br /> var rowIndex = index;<br /> if( index &gt; -1 ) rowIndex = index + i;<br /> var m = _copyARow( table, baseRows[i], rowIndex );<br /> if( i == 0 ) firstIndex = m;<br /> table.nextRowNo++;<br /> }<br /> return firstIndex;<br /> }</p> 
  <p>数据的复制都是在_copyARow( table, baseRows[i], rowIndex )这个js中实现的，所以报表复制上一行数据并且第一列流水号增加的功能就要在这个js中实现。<br /> function _copyARow111( table, baseRow, index ) {<br /> var newrow = table.insertRow( index );<br /> var newRowStyle = baseRow.cloneNode( true );<br /> newRowStyle.id = table.id + “_row” + table.nextRowNo;<br /> newRowStyle.status = “2″;<br /> newrow.replaceNode( newRowStyle );<br /> var currCell = null;<br /> for( var i = 0; i &lt; baseRow.cells.length; i++ ) {<br /> var newColStyle = newRowStyle.cells[i];<br /> if( table.currCell == baseRow.cells[i] ) currCell = newColStyle;<br /> if( newColStyle.oldBkcolor != null ) newColStyle.style.backgroundColor = newColStyle.oldBkcolor;<br /> if( newColStyle.flow ) {<br /> if( newColStyle.flow.indexOf( “rowNoInGroup” ) &lt; 0 ) {<br /> li_currTbl = table;<br /> li_currCell = newColStyle;<br /> var flow = eval( newColStyle.flow ) + “”;<br /> if(flow!=null&amp;&amp;flow!=””){<br /> newColStyle.innerText = flow;<br /> newColStyle.value = flow;<br /> }<br /> }<br /> }<br /> else {<br /> var es = newColStyle.editStyle;<br /> }<br /> var id = newColStyle.id;<br /> var pos = 0;<br /> for( var k = id.length – 1; k &gt;= 0; k– ) {<br /> var s = id.substring( k );<br /> if( isNaN( s ) ) {<br /> pos = k + 1;<br /> break;<br /> }<br /> }<br /> id = id.substring( 0, pos ) + table.nextRowNo;<br /> newColStyle.id = id;<br /> if( newColStyle.filterCells != null ) {<br /> var fcs = newColStyle.filterCells.split( “,” );<br /> var s2 = “”;<br /> for( var m = 0; m &lt; fcs.length; m++ ) {<br /> var fc = fcs[m];<br /> var spos = 0;<br /> for( var k = fc.length – 1; k &gt;= 0; k– ) {<br /> var s = fc.substring( k );<br /> if( isNaN( s ) ) {<br /> spos = k + 1;<br /> break;<br /> }<br /> }<br /> fc = fc.substring( 0, spos ) + table.nextRowNo<br /> if( s2.length &gt; 0 ) s2 += “,”;<br /> s2 += fc;<br /> }<br /> newColStyle.filterCells = s2;<br /> }<br /> }<br /> if( currCell != null &amp;&amp; !table.isImport ) _bindingEditor( currCell );<br /> return newRowStyle.rowIndex;<br /> }</p> 
  <p>这样就能实现插入复制行，当然报表自增的字段仍然需要设置流水号，而且流水号取值要用自增1的函数例如：groupMaxNumber()；这些js也要重命名一下，用以区别报表自带的同名js。</p>  
 </body>
</html>